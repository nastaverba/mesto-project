(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector("#edit"),n=document.querySelector("#add"),o=document.querySelector(".profile__add-btn"),c=document.querySelector(".profile__name-edit"),r=document.querySelector("#edit-ava"),u=document.querySelector(".profile__image-edit"),a=document.querySelector("#addPlace"),i=document.querySelector("#create-btn"),l=document.querySelector(".popup__element_data_photoname"),s=document.querySelector(".popup__element_data_photolink"),d=document.querySelector(".popup__element_data_avatar"),_=document.querySelector("#profileAvatar"),p=document.querySelector(".profile__name-text"),f=document.querySelector(".profile__desc"),m=document.querySelector(".profile__image"),v=document.querySelector("#profileInfo"),y=document.querySelector(".popup__element_data_firstname"),h=document.querySelector(".popup__element_data_about"),S=document.querySelector("#card").content,q=document.querySelector(".cards"),k=document.querySelector("#photo-full"),L=document.querySelector(".popup__img"),b=document.querySelector(".popup__caption"),E=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function j(e,t,n){var o=S.querySelector(".card").cloneNode(!0);o.querySelector(".card__name-text").textContent=e,o.querySelector(".card__image").src=t,o.querySelector(".card__image").alt=e,o.querySelector(".card__like-count").textContent=n,o.querySelector(".card__remove-icon").addEventListener("click",(function(){o.remove()}));var c=o.querySelector(".card__image"),r=o.querySelector(".card__name-text");return c.addEventListener("click",(function(){x(k),L.src=c.src,L.alt=r.textContent,b.textContent=r.textContent})),o}var P,A="https://nomoreparties.co/v1/plus-cohort-12",T={authorization:"ebed94c5-4469-48fb-a5ed-153cc27ff20d","Content-Type":"application/json"},D=function(){return fetch("".concat(A,"/users/me"),{headers:T}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))};function B(e,t,n){p.textContent=e,f.textContent=t,m.style.backgroundImage="url(".concat(n)}function N(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function O(e,t){t.textContent=e?"Сохранение...":"Создать"}Promise.all([fetch("".concat(A,"/cards"),{headers:T}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),D()]).then((function(e){e[0].forEach((function(t){var n=j(t.name,t.link,t.likes.length);t.owner._id!==e[1]._id&&n.querySelector(".card__remove-icon").classList.remove("card__remove-icon_active");var o,c=n.querySelector(".card__like");t.likes.some((function(t){return t._id===e[1]._id}))&&c.classList.add("card__like_liked"),n.querySelector(".card__remove-icon").addEventListener("click",(function(){var e;(e=t._id,fetch("".concat(A,"/cards/").concat(e),{method:"DELETE",headers:T}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){console.log(e)}))})),c.addEventListener("click",(function(){var o;t.likes.every((function(t){return t._id!==e[1]._id}))?(o=t._id,fetch("".concat(A,"/cards/likes/").concat(o),{method:"PUT",headers:T}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){n.querySelector(".card__like-count").textContent=e.likes.length})).then((function(){c.classList.add("card__like_liked")})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(A,"/cards/likes/").concat(e),{method:"DELETE",headers:T}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(t._id).then((function(e){n.querySelector(".card__like-count").textContent=e.likes.length})).then((function(){c.classList.remove("card__like_liked")})).catch((function(e){console.log(e)}))})),o=n,q.append(o)}))})).catch((function(e){console.log(e)})),D().then((function(e){B(e.name,e.about,e.avatar)})).catch((function(e){console.log(e)})),v.addEventListener("submit",(function(e){e.preventDefault(),N(!0,v.querySelector(".popup__btn")),(y.value,h.value,fetch("".concat(A,"/users/me"),{method:"PATCH",headers:T,body:JSON.stringify({name:y.value,about:h.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){B(e.name,e.about,e.avatar)})).then((function(){C(t)})).catch((function(e){console.log(e)})).finally((function(){N(!1,v.querySelector(".popup__btn"))}))})),_.addEventListener("submit",(function(e){e.preventDefault(),N(!0,_.querySelector(".popup__btn")),(d.value,fetch("".concat(A,"/users/me/avatar"),{method:"PATCH",headers:T,body:JSON.stringify({avatar:d.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){B(e.name,e.about,e.avatar)})).then((function(){C(r)})).catch((function(e){console.log(e)})).finally((function(){N(!1,_.querySelector(".popup__btn"))}))})),a.addEventListener("submit",(function(e){e.preventDefault(),O(!0,a.querySelector(".popup__btn")),fetch("".concat(A,"/cards"),{method:"POST",headers:T,body:JSON.stringify({name:l.value,link:s.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){var t;t=j(e.name,e.link,e.likes.length),q.prepend(t)})).then((function(){a.reset()})).then((function(){i.classList.add("popup__btn_inactive")})).then((function(){i.disabled=!0})).then((function(){C(n)})).catch((function(e){console.log(e)})).finally((function(){O(!1,a.querySelector(".popup__btn"))}))})),o.addEventListener("click",(function(){x(n)})),c.addEventListener("click",(function(){y.value=p.textContent,h.value=f.textContent,x(t)})),u.addEventListener("click",(function(){x(r)})),e.forEach((function(e){e.querySelector(".popup__close-icon").addEventListener("click",(function(){C(e)})),e.addEventListener("click",(function(t){t.target.classList.contains("popup")&&C(e)}))})),P={formSelector:".form",inputSelector:".popup__element",submitButtonSelector:".popup__btn",inactiveButtonClass:"popup__btn_inactive",inputErrorClass:"popup__element_type_error",errorClass:"popup__element-error_active"},Array.from(document.querySelectorAll(P.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);E(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),E(n,o,t)}))}))}(e,P)}))})();