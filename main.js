(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector("#edit"),n=document.querySelector("#add"),o=document.querySelector(".profile__add-btn"),c=document.querySelector(".profile__name-edit"),r=document.querySelector("#edit-ava"),u=document.querySelector(".profile__image-edit"),a=document.querySelector("#addPlace"),i=document.querySelector("#create-btn"),l=document.querySelector(".popup__element_data_photoname"),d=document.querySelector(".popup__element_data_photolink"),s=document.querySelector(".popup__element_data_avatar"),_=document.querySelector("#profileAvatar"),p=document.querySelector(".profile__name-text"),f=document.querySelector(".profile__desc"),m=document.querySelector(".profile__image"),v=document.querySelector("#profileInfo"),y=document.querySelector(".popup__element_data_firstname"),h=document.querySelector(".popup__element_data_about"),S=document.querySelector("#card").content,q=document.querySelector(".cards"),k=document.querySelector("#photo-full"),b=document.querySelector(".popup__img"),L=document.querySelector(".popup__caption"),E=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g)}function g(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}function x(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g)}function A(e,t,n,o,c,r,u,a,i){var l=S.querySelector(".card").cloneNode(!0),d=l.querySelector(".card__image");l.querySelector(".card__name-text").textContent=e,d.src=t,d.alt=e,l.querySelector(".card__like-count").textContent=n;var s=l.querySelector(".card__name-text");return d.addEventListener("click",(function(){x(k),b.src=d.src,b.alt=s.textContent,L.textContent=s.textContent})),function(e,t,n){var o=n.querySelector(".card__like");e.some((function(e){return e._id===t}))&&o.classList.add("card__like_liked")}(c,r,l),function(e,t,n){e!==t&&n.querySelector(".card__remove-icon").classList.remove("card__remove-icon_active")}(u,r,l),l.querySelector(".card__remove-icon").addEventListener("click",(function(){a(o,l)})),l.querySelector(".card__like").addEventListener("click",(function(){i(c,r,o,l)})),l}function T(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var D="https://nomoreparties.co/v1/plus-cohort-12",P={authorization:"ebed94c5-4469-48fb-a5ed-153cc27ff20d","Content-Type":"application/json"};function w(e,t,n){p.textContent=e,f.textContent=t,m.style.backgroundImage="url(".concat(n)}function B(e,t){e.textContent=t}function N(e,t){(function(e){return fetch("".concat(D,"/cards/").concat(e),{method:"DELETE",headers:P}).then((function(e){return T(e)}))})(e).then((function(){!function(e){e.remove()}(t)})).catch((function(e){console.log(e)}))}function O(e,t,n,o){e.every((function(e){return e._id!==t}))?function(e){return fetch("".concat(D,"/cards/likes/").concat(e),{method:"PUT",headers:P}).then((function(e){return T(e)}))}(n).then((function(e){!function(e,t){var n=t.querySelector(".card__like");t.querySelector(".card__like-count").textContent=e.likes.length,n.classList.add("card__like_liked")}(e,o)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(D,"/cards/likes/").concat(e),{method:"DELETE",headers:P}).then((function(e){return T(e)}))}(n).then((function(e){!function(e,t){var n=t.querySelector(".card__like");t.querySelector(".card__like-count").textContent=e.likes.length,n.classList.remove("card__like_liked")}(e,o)})).catch((function(e){console.log(e)}))}var j,J="";fetch("".concat(D,"/users/me"),{headers:P}).then((function(e){return T(e)})).then((function(e){J=e._id,w(e.name,e.about,e.avatar)})).catch((function(e){console.log(e)})),fetch("".concat(D,"/cards"),{headers:P}).then((function(e){return T(e)})).then((function(e){e.forEach((function(e){var t;t=A(e.name,e.link,e.likes.length,e._id,e.likes,J,e.owner._id,N,O),q.append(t)}))})).catch((function(e){console.log(e)})),v.addEventListener("submit",(function(e){e.preventDefault(),B(v.querySelector(".popup__btn"),"Сохранение..."),(y.value,h.value,fetch("".concat(D,"/users/me"),{method:"PATCH",headers:P,body:JSON.stringify({name:y.value,about:h.value})}).then((function(e){return T(e)}))).then((function(e){w(e.name,e.about,e.avatar),C(t)})).catch((function(e){console.log(e)})).finally((function(){B(v.querySelector(".popup__btn"),"Сохранить")}))})),_.addEventListener("submit",(function(e){e.preventDefault(),B(_.querySelector(".popup__btn"),"Сохранение..."),(s.value,fetch("".concat(D,"/users/me/avatar"),{method:"PATCH",headers:P,body:JSON.stringify({avatar:s.value})}).then((function(e){return T(e)}))).then((function(e){w(e.name,e.about,e.avatar),C(r)})).catch((function(e){console.log(e)})).finally((function(){B(_.querySelector(".popup__btn"),"Сохранить")}))})),a.addEventListener("submit",(function(e){e.preventDefault(),B(a.querySelector(".popup__btn"),"Сохранение..."),fetch("".concat(D,"/cards"),{method:"POST",headers:P,body:JSON.stringify({name:l.value,link:d.value})}).then((function(e){return T(e)})).then((function(e){var t;t=A(e.name,e.link,e.likes.length,e._id,e.likes,J,e.owner._id,N,O),q.prepend(t),a.reset(),i.classList.add("popup__btn_inactive"),i.disabled=!0,C(n)})).catch((function(e){console.log(e)})).finally((function(){B(a.querySelector(".popup__btn"),"Создать")}))})),o.addEventListener("click",(function(){x(n)})),c.addEventListener("click",(function(){y.value=p.textContent,h.value=f.textContent,x(t)})),u.addEventListener("click",(function(){x(r)})),e.forEach((function(e){e.querySelector(".popup__close-icon").addEventListener("click",(function(){C(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&C(e)}))})),j={formSelector:".form",inputSelector:".popup__element",submitButtonSelector:".popup__btn",inactiveButtonClass:"popup__btn_inactive",inputErrorClass:"popup__element_type_error",errorClass:"popup__element-error_active"},Array.from(document.querySelectorAll(j.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);E(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),E(n,o,t)}))}))}(e,j)}))})();