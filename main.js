(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{u:()=>H,x:()=>J});var t=document.querySelectorAll(".popup"),n=document.querySelector("#edit"),o=document.querySelector("#add"),c=document.querySelector(".profile__add-btn"),r=document.querySelector(".profile__name-edit"),u=document.querySelector("#edit-ava"),a=document.querySelector(".profile__image-edit"),i=document.querySelector("#addPlace"),l=document.querySelector("#create-btn"),d=document.querySelector(".popup__element_data_photoname"),s=document.querySelector(".popup__element_data_photolink"),p=document.querySelector(".popup__element_data_avatar"),f=document.querySelector("#profileAvatar"),_=document.querySelector(".profile__name-text"),m=document.querySelector(".profile__desc"),v=document.querySelector(".profile__image"),y=document.querySelector("#profileInfo"),h=document.querySelector(".popup__element_data_firstname"),S=document.querySelector(".popup__element_data_about"),q=document.querySelector("#card").content,k=document.querySelector(".cards"),b=document.querySelector("#photo-full"),L=document.querySelector(".popup__img"),E=document.querySelector(".popup__caption"),C=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)};function g(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",x)}function x(e){"Escape"===e.key&&g(document.querySelector(".popup_opened"))}function j(e){e.classList.add("popup_opened"),document.addEventListener("keydown",x)}function P(e,t,n,o,c,r,u){var a=q.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image");a.querySelector(".card__name-text").textContent=e,i.src=t,i.alt=e,a.querySelector(".card__like-count").textContent=n;var l=a.querySelector(".card__name-text");return i.addEventListener("click",(function(){j(b),L.src=i.src,L.alt=l.textContent,E.textContent=l.textContent})),function(e,t,n){var o=n.querySelector(".card__like");e.some((function(e){return e._id===t}))&&o.classList.add("card__like_liked")}(c,r,a),function(e,t,n){e!==t&&n.querySelector(".card__remove-icon").classList.remove("card__remove-icon_active")}(u,r,a),a.querySelector(".card__remove-icon").addEventListener("click",(function(){J(o,a)})),a.querySelector(".card__like").addEventListener("click",(function(){H(c,r,o,a)})),a}function A(e){if(!e.ok)return Promise.reject("Ошибка: ".concat(e.status))}var w,O="https://nomoreparties.co/v1/plus-cohort-12",T={authorization:"ebed94c5-4469-48fb-a5ed-153cc27ff20d","Content-Type":"application/json"},D=function(){return fetch("".concat(O,"/users/me"),{headers:T}).then((function(e){return A(e),e.json()}))};function B(e,t,n){_.textContent=e,m.textContent=t,v.style.backgroundImage="url(".concat(n)}function N(e,t){e.textContent=t}function J(e,t){(function(e){return fetch("".concat(O,"/cards/").concat(e),{method:"DELETE",headers:T}).then((function(e){return A(e),e.json()}))})(e).then((function(){!function(e){e.remove()}(t)})).catch((function(e){console.log(e)}))}function H(e,t,n,o){e.every((function(e){return e._id!==t}))?function(e){return fetch("".concat(O,"/cards/likes/").concat(e),{method:"PUT",headers:T}).then((function(e){return A(e),e.json()}))}(n).then((function(e){!function(e,t){var n=t.querySelector(".card__like");t.querySelector(".card__like-count").textContent=e.likes.length,n.classList.add("card__like_liked")}(e,o)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(O,"/cards/likes/").concat(e),{method:"DELETE",headers:T}).then((function(e){return A(e),e.json()}))}(n).then((function(e){!function(e,t){var n=t.querySelector(".card__like");t.querySelector(".card__like-count").textContent=e.likes.length,n.classList.remove("card__like_liked")}(e,o)})).catch((function(e){console.log(e)}))}Promise.all([fetch("".concat(O,"/cards"),{headers:T}).then((function(e){return A(e),e.json()})),D()]).then((function(e){e[0].forEach((function(t){var n;n=P(t.name,t.link,t.likes.length,t._id,t.likes,e[1]._id,t.owner._id),k.append(n)}))})).catch((function(e){console.log(e)})),D().then((function(e){B(e.name,e.about,e.avatar)})).catch((function(e){console.log(e)})),y.addEventListener("submit",(function(e){e.preventDefault(),N(y.querySelector(".popup__btn"),"Сохранение..."),(h.value,S.value,fetch("".concat(O,"/users/me"),{method:"PATCH",headers:T,body:JSON.stringify({name:h.value,about:S.value})}).then((function(e){return A(e),e.json()}))).then((function(e){B(e.name,e.about,e.avatar),g(n)})).catch((function(e){console.log(e)})).finally((function(){N(y.querySelector(".popup__btn"),"Сохранить")}))})),f.addEventListener("submit",(function(e){e.preventDefault(),N(f.querySelector(".popup__btn"),"Сохранение..."),(p.value,fetch("".concat(O,"/users/me/avatar"),{method:"PATCH",headers:T,body:JSON.stringify({avatar:p.value})}).then((function(e){return A(e),e.json()}))).then((function(e){B(e.name,e.about,e.avatar),g(u)})).catch((function(e){console.log(e)})).finally((function(){N(f.querySelector(".popup__btn"),"Сохранить")}))})),i.addEventListener("submit",(function(e){e.preventDefault(),N(i.querySelector(".popup__btn"),"Сохранение..."),fetch("".concat(O,"/cards"),{method:"POST",headers:T,body:JSON.stringify({name:d.value,link:s.value})}).then((function(e){return A(e),e.json()})).then((function(e){var t;t=P(e.name,e.link,e.likes.length,e._id,e.likes,e.owner._id,e.owner._id),k.prepend(t),i.reset(),l.classList.add("popup__btn_inactive"),l.disabled=!0,g(o)})).catch((function(e){console.log(e)})).finally((function(){N(i.querySelector(".popup__btn"),"Создать")}))})),c.addEventListener("click",(function(){j(o)})),r.addEventListener("click",(function(){h.value=_.textContent,S.value=m.textContent,j(n)})),a.addEventListener("click",(function(){j(u)})),t.forEach((function(e){e.querySelector(".popup__close-icon").addEventListener("click",(function(){g(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&g(e)}))})),w={formSelector:".form",inputSelector:".popup__element",submitButtonSelector:".popup__btn",inactiveButtonClass:"popup__btn_inactive",inputErrorClass:"popup__element_type_error",errorClass:"popup__element-error_active"},Array.from(document.querySelectorAll(w.formSelector)).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);C(n,o,t),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent="",o.classList.remove(n.errorClass)}(e,t,n):function(e,t,n,o){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),c.textContent=n,c.classList.add(o.errorClass)}(e,t,t.validationMessage,n)}(e,c,t),C(n,o,t)}))}))}(e,w)}))})();